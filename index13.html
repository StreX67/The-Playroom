<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>Cymbergaj</title>

<style>
body{margin:0;background:#08101f;color:white;text-align:center;font-family:Arial}
canvas{background:#0f2a4d;margin:20px auto;display:block;border-radius:15px}
#msg{position:fixed;top:40%;left:50%;transform:translate(-50%,-50%);
font-size:40px;background:#000a;padding:20px;border-radius:10px;display:none}
button,select{font-size:16px;margin:5px;padding:6px 12px;border-radius:6px;border:none;cursor:pointer}
.back{background:#444;color:white;margin-top:20px}
</style>
</head>
<body>

<h2>Cymbergaj</h2>

<!-- üîô PRZYCISK POWROTU -->
<button class="back" onclick="location.href='index.html'">‚¨Ö Powr√≥t do menu</button>
<br><br>

<button id="startBtn" onclick="start()">START</button>
<span id="surrenderBtns"></span>

Tryb:
<select id="mode">
<option value="pvp">1 vs 1</option>
<option value="bot">vs BOT</option>
</select>

BOT:
<select id="bot">
<option value="2">≈Åatwy</option>
<option value="3">≈öredni</option>
<option value="5">Trudny</option>
<option value="7">Mistrz</option>
</select>

Czas:
<select id="time">
<option value="60">1 min</option>
<option value="120">2 min</option>
<option value="180">3 min</option>
<option value="300">5 min</option>
</select>

<div>
Runda: <span id="s1">0</span> - <span id="s2">0</span> |
Czas: <span id="t">0</span>
</div>

<canvas id="c" width="900" height="500"></canvas>
<div id="msg"></div>

<script>
let c=document.getElementById("c"),ctx=c.getContext("2d");
let p1,p2,puck,keys={},lastPress={};

let s1=0,s2=0,time=0,run=false,last=0;
let goalTop=180,goalBottom=320;
let dashCooldownP1=0,dashCooldownP2=0;
let countdownActive=false;

let startBtn=document.getElementById("startBtn");
let surrenderDiv=document.getElementById("surrenderBtns");
let mode=document.getElementById("mode");
let botSel=document.getElementById("bot");
let timeSel=document.getElementById("time");
let s1Span=document.getElementById("s1");
let s2Span=document.getElementById("s2");
let t=document.getElementById("t");
let msg=document.getElementById("msg");

/* INPUT */
document.onkeydown=e=>{
if(countdownActive||!run)return;
if(!keys[e.key]){
if(lastPress[e.key] && Date.now()-lastPress[e.key]<250) dash(e.key);
lastPress[e.key]=Date.now();
}
keys[e.key]=1;
};
document.onkeyup=e=>keys[e.key]=0;

/* START */
function start(){
s1=s2=0;
s1Span.innerText=0;
s2Span.innerText=0;
time=parseInt(timeSel.value);

resetPlayersCenter();
startCountdown();

run=true;
startBtn.disabled=true;
mode.disabled=true;
botSel.disabled=true;
timeSel.disabled=true;

if(mode.value=="bot"){
surrenderDiv.innerHTML='<button onclick="surrender(1)">Poddaj siƒô</button>';
}else{
surrenderDiv.innerHTML=
'<button onclick="surrender(1)">P1 poddaj</button>'+
'<button onclick="surrender(2)">P2 poddaj</button>';
}

requestAnimationFrame(loop);
}

function endGame(){
startBtn.disabled=false;
mode.disabled=false;
botSel.disabled=false;
timeSel.disabled=false;
surrenderDiv.innerHTML="";
}

function surrender(player){
if(!run)return;
run=false;
msg.style.display="block";
msg.innerText="Gracz "+player+" siƒô podda≈Ç!";
endGame();
}

/* RESET */
function resetPlayersCenter(){
p1={x:120,y:250,r:22,d:0};
p2={x:780,y:250,r:22,d:0};
puck={x:450,y:250,vx:0,vy:0,r:12,wait:1};
}

function resetAfterGoal(loser){
p1={x:120,y:250,r:22,d:0};
p2={x:780,y:250,r:22,d:0};

if(loser==1) puck={x:160,y:250,vx:0,vy:0,r:12,wait:1};
else puck={x:740,y:250,vx:0,vy:0,r:12,wait:1};
}

/* COUNTDOWN */
function startCountdown(){
countdownActive=true;
let count=3;
msg.style.display="block";
msg.innerText=count;

let i=setInterval(()=>{
count--;
if(count>0) msg.innerText=count;
else if(count==0) msg.innerText="START!";
else{
clearInterval(i);
msg.style.display="none";
countdownActive=false;
}
},1000);
}

/* DASH */
function dash(k){
if(k.includes("Arrow") && dashCooldownP1<=0){
p1.d=28; dashCooldownP1=30;
}
if("wasd".includes(k) && mode.value=="pvp" && dashCooldownP2<=0){
p2.d=28; dashCooldownP2=30;
}
}

/* LOOP */
function loop(ts){
if(!run)return;

let dt=(ts-last)/1000;
last=ts;
time-=dt;

if(time<=0){
time=0;
run=false;
msg.style.display="block";

if(s1>s2) msg.innerText="WYGRYWA GRACZ 1";
else if(s2>s1) msg.innerText="WYGRYWA GRACZ 2";
else msg.innerText="REMIS";

endGame();
return;
}

if(dashCooldownP1>0)dashCooldownP1--;
if(dashCooldownP2>0)dashCooldownP2--;

move();
draw();
t.innerText=Math.ceil(time);

requestAnimationFrame(loop);
}

/* MOVE */
function move(){
if(countdownActive)return;

let sp=5;
if(p1.d>0)p1.d--;
if(p2.d>0)p2.d--;

let s1d=sp+(p1.d?10:0);
let s2d=sp+(p2.d?10:0);

if(keys.ArrowUp)p1.y-=s1d;
if(keys.ArrowDown)p1.y+=s1d;
if(keys.ArrowLeft)p1.x-=s1d;
if(keys.ArrowRight)p1.x+=s1d;

if(mode.value=="pvp"){
if(keys.w)p2.y-=s2d;
if(keys.s)p2.y+=s2d;
if(keys.a)p2.x-=s2d;
if(keys.d)p2.x+=s2d;
}else botMove();

bounds();

if(puck.wait){
if(dist(p1,puck)<35||dist(p2,puck)<35)puck.wait=0;
return;
}

puck.x+=puck.vx;
puck.y+=puck.vy;

if(puck.y<12){puck.y=12;puck.vy=Math.abs(puck.vy);}
if(puck.y>488){puck.y=488;puck.vy=-Math.abs(puck.vy);}

if(puck.x<12){
if(puck.y>goalTop&&puck.y<goalBottom) score(2);
else{puck.x=12;puck.vx=Math.abs(puck.vx);}
}

if(puck.x>888){
if(puck.y>goalTop&&puck.y<goalBottom) score(1);
else{puck.x=888;puck.vx=-Math.abs(puck.vx);}
}

collide(p1);
collide(p2);
}

function botMove(){
let lvl=parseInt(botSel.value);
let speed=3+lvl*0.7;
if(puck.wait){moveTo(520,250,speed);return;}
let fx=puck.x+puck.vx*(10+lvl*2);
let fy=puck.y+puck.vy*(10+lvl*2);
let tx=puck.x>650?760:fx-30;
let ty=fy;
tx=Math.max(480,Math.min(870,tx));
ty=Math.max(40,Math.min(460,ty));
moveTo(tx,ty,speed);
}

function collide(p){
let dx=puck.x-p.x;
let dy=puck.y-p.y;
let d=Math.hypot(dx,dy);
if(d<p.r+puck.r){
let angle=Math.atan2(dy,dx);
let power=8;
if(p==p1 && p.d>15) power=18;
puck.vx=Math.cos(angle)*power;
puck.vy=Math.sin(angle)*power;
}
}

function moveTo(x,y,sp){
if(p2.x<x)p2.x+=sp;
if(p2.x>x)p2.x-=sp;
if(p2.y<y)p2.y+=sp;
if(p2.y>y)p2.y-=sp;
}

function bounds(){
p1.x=Math.max(22,Math.min(440,p1.x));
p2.x=Math.max(470,Math.min(878,p2.x));
p1.y=Math.max(22,Math.min(478,p1.y));
p2.y=Math.max(22,Math.min(478,p2.y));
}

function dist(a,b){return Math.hypot(a.x-b.x,a.y-b.y)}

function score(player){
msg.style.display="block";
msg.innerText="PUNKT dla gracza "+player;
setTimeout(()=>msg.style.display="none",1200);

if(player==1){s1++;resetAfterGoal(2);}
else{s2++;resetAfterGoal(1);}

s1Span.innerText=s1;
s2Span.innerText=s2;
}

function draw(){
ctx.clearRect(0,0,900,500);
ctx.beginPath();ctx.moveTo(450,0);ctx.lineTo(450,500);
ctx.strokeStyle="#00eaff";ctx.lineWidth=3;ctx.stroke();
ctx.beginPath();ctx.arc(450,250,60,0,Math.PI*2);ctx.stroke();
ctx.fillStyle="#fff";
ctx.fillRect(0,goalTop,8,goalBottom-goalTop);
ctx.fillRect(892,goalTop,8,goalBottom-goalTop);
circle(p1,"#0f8");
circle(p2,"#f06");
circle(puck,"#fff");
}
function circle(o,c){
ctx.beginPath();
ctx.arc(o.x,o.y,o.r,0,7);
ctx.fillStyle=c;
ctx.fill();
}
</script>

</body>
</html>
